{% extends 'base.html' %}
{% block content %}
<h1 class="mb-4">Settings</h1>
<div class="card mb-3">
  <div class="card-header bg-primary text-white">Tableau Online</div>
  <div class="card-body">
    <div class="mb-3">
      <label class="form-label">Token Name</label>
      <input type="text" id="token_name" class="form-control" value="{{ config['tableau_online'].get('personal_access_token_name', '') }}">
    </div>
    <div class="mb-3">
      <label class="form-label">Token Secret</label>
      <input type="password" id="token_secret" class="form-control" value="{{ config['tableau_online'].get('personal_access_token_secret', '') }}">
    </div>
  </div>
</div>
<div class="card mb-3">
  <div class="card-header bg-success text-white">File Paths</div>
  <div class="card-body">
    <div class="mb-3">
      <label class="form-label">Reference Data</label>
      <div class="input-group">
        <input type="text" id="ref_data_path" class="form-control" value="{{ config['files'].get('ref_data_path', '') }}">
        <button class="btn btn-outline-secondary" onclick="selectFile('ref_data_path')">Browse</button>
      </div>
    </div>
    <div class="mb-3">
      <label class="form-label">Master File</label>
      <div class="input-group">
        <input type="text" id="master_file_path" class="form-control" value="{{ config['files'].get('master_file_path', '') }}">
        <button class="btn btn-outline-secondary" onclick="selectFile('master_file_path')">Browse</button>
      </div>
    </div>
  </div>
</div>
<div class="card mb-3">
  <div class="card-header bg-info text-white">Appearance</div>
  <div class="card-body">
    <div class="mb-3">
      <label class="form-label">Theme</label>
      <select id="theme" class="form-select" onchange="applyTheme(this.value)">
        <option value="light">Light</option>
        <option value="dark">Dark</option>
        <option value="colorful">Colorful</option>
      </select>
    </div>
  </div>
</div>
<button class="btn btn-primary" onclick="saveSettings()">Save</button>

<script>
async function saveSettings() {
  const data = {
    token_name: document.getElementById('token_name').value,
    token_secret: document.getElementById('token_secret').value,
    ref_data_path: document.getElementById('ref_data_path').value,
    master_file_path: document.getElementById('master_file_path').value,
    theme: document.getElementById('theme').value
  };
  
  try {
    const response = await fetch('/api/save_settings', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    });
    
    const result = await response.json();
    if (result.status === 'success') {
      alert('Settings saved successfully');
      // Reload the page to reflect changes
      window.location.reload();
    } else {
      alert('Error saving settings: ' + result.message);
    }
  } catch (error) {
    alert('Error saving settings: ' + error.message);
  }
}
</script>
{% endblock %}
